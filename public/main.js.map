{"version":3,"file":"main.js","sources":["webpack:///./src/plot.js","webpack:///./src/styleMain.css","webpack:///./src/main.js","webpack:///./src/stylePlot.css"],"sourcesContent":["import React, { Component } from \"react\";\nimport { render } from \"react-dom\";\nimport style from \"./stylePlot\";\nimport * as d3 from \"d3\";\nimport PT from \"prop-types\";\nimport { pure } from \"recompose\";\nconst RADIUS = 180;\nconst WIDTH = 300;\nconst HEIGHT = 300;\nconst aScale = d3.scaleLinear().domain([-0.1, 0.1]).range([0, WIDTH]);\nconst bScale = d3.scaleLinear().domain([-0.1, 0.1]).range([HEIGHT, 0]);\nconst colorScale = d3.scaleSequential(d3.interpolatePlasma).domain([-0.05, 0.05]);\n// .domain\nconst mar = {\n\ttop: 10,\n\tleft: 20,\n\tbottom: 20,\n\tright: 10\n};\n\nexport default class Plot extends React.PureComponent {\n\tcomponentDidMount() {\n\t\t// console.log(\"hello\");\n\t\td3.select(this.xAxis).call(d3.axisBottom().scale(aScale).ticks(2));\n\t\td3.select(this.yAxis).call(d3.axisLeft().scale(bScale).ticks(2));\n\t\t// this.a0 = 0;\n\t\t// this.b0 = 0;\n\t\tthis.ctx = this.canvas.getContext(\"2d\");\n\t}\n\n\trender() {\n\t\tlet M = 0,\n\t\t    a = 0,\n\t\t    b = 0;\n\t\tfor (var d of this.props.cups) {\n\t\t\ta += -d.m * Math.sin(d.θ);\n\t\t\tb += d.m * Math.cos(d.θ);\n\t\t\tM += d.m;\n\t\t}\n\t\ta = a / M;\n\t\tb = b / M;\n\t\tif (this.a0) {\n\t\t\tlet ctx = this.ctx;\n\t\t\tctx.strokeStyle = colorScale(this.props.ω);\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(aScale(this.a0), bScale(this.b0));\n\t\t\tctx.lineTo(aScale(a), bScale(b));\n\t\t\tctx.stroke();\n\t\t}\n\t\tthis.a0 = a;\n\t\tthis.b0 = b;\n\n\t\treturn React.createElement(\n\t\t\t\"div\",\n\t\t\t{ className: style.plot },\n\t\t\tReact.createElement(\"canvas\", {\n\t\t\t\tstyle: { left: mar.left, top: mar.top, height: HEIGHT, width: WIDTH },\n\t\t\t\tclassName: style.canvas,\n\t\t\t\tref: d => this.canvas = d,\n\t\t\t\twidth: WIDTH,\n\t\t\t\theight: HEIGHT\n\t\t\t}),\n\t\t\tReact.createElement(\n\t\t\t\t\"svg\",\n\t\t\t\t{\n\t\t\t\t\twidth: WIDTH + mar.left + mar.right,\n\t\t\t\t\theight: HEIGHT + mar.top + mar.bottom,\n\t\t\t\t\tclassName: style.plot\n\t\t\t\t},\n\t\t\t\tReact.createElement(\n\t\t\t\t\t\"g\",\n\t\t\t\t\t{ transform: `translate(${mar.left},${mar.right})` },\n\t\t\t\t\tReact.createElement(\"g\", {\n\t\t\t\t\t\tref: d => this.xAxis = d,\n\t\t\t\t\t\ttransform: `translate(0,${HEIGHT / 2})`\n\t\t\t\t\t}),\n\t\t\t\t\tReact.createElement(\"g\", {\n\t\t\t\t\t\ttransform: `translate(${WIDTH / 2}, 0)`,\n\t\t\t\t\t\tref: d => this.yAxis = d\n\t\t\t\t\t}),\n\t\t\t\t\tReact.createElement(\"circle\", {\n\t\t\t\t\t\tr: \"3\",\n\t\t\t\t\t\tclassName: style.dot,\n\t\t\t\t\t\ttransform: `translate(${aScale(a)},${bScale(b)})`\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t)\n\t\t);\n\t}\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/plot.js\n// module id = 80\n// module chunks = 1","// removed by extract-text-webpack-plugin\nmodule.exports = {\"wheel\":\"styleMain__wheel___3Nt\",\"cup\":\"styleMain__cup___3O1\",\"shell\":\"styleMain__shell___346\",\"fill\":\"styleMain__fill___3Dz\",\"water\":\"styleMain__water___3vY\",\"spigot\":\"styleMain__spigot___39O\",\"row\":\"styleMain__row___25W\"};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/styleMain.css\n// module id = 81\n// module chunks = 1","import React, { Component } from \"react\";\nimport { render } from \"react-dom\";\nimport style from \"./styleMain\";\nimport Plot from \"./plot\";\nimport * as d3 from \"d3\";\nimport PT from \"prop-types\";\nimport { pure } from \"recompose\";\n\nconst RADIUS = 180;\nconst HEIGHT = 400;\nconst WIDTH = 400;\nconst NUM_CUPS = 36;\nconst τ = Math.PI * 2;\nconst ν = 8;\nconst γ = 1 / 20;\nconst λ = 0.1;\nconst k = 0.0005;\nconst WHEEL_INTERTIA = 100;\n\nconst Cup = pure(({ θ, m }) => {\n\tlet pos = [Math.cos(θ + Math.PI / 2) * RADIUS, -Math.sin(θ + Math.PI / 2) * RADIUS];\n\treturn React.createElement(\n\t\t\"g\",\n\t\t{ className: style.cup, transform: `translate(${pos}) translate(-9,-8)` },\n\t\tReact.createElement(\"rect\", { width: \"18\", height: \"16\", className: style.shell }),\n\t\tReact.createElement(\"rect\", { width: \"14\", height: \"14\", x: \"2\", className: style.fill }),\n\t\tReact.createElement(\"rect\", { width: \"14\", x: \"2\", height: m, y: 14 - m, className: style.water })\n\t);\n});\n\nconst Vis = pure(({ cups }) => {\n\treturn React.createElement(\n\t\t\"svg\",\n\t\t{ width: WIDTH, height: HEIGHT },\n\t\tReact.createElement(\"line\", {\n\t\t\tx1: WIDTH / 2,\n\t\t\tx2: WIDTH / 2,\n\t\t\ty2: HEIGHT,\n\t\t\tclassName: style.spigot\n\t\t}),\n\t\t\";\",\n\t\tReact.createElement(\n\t\t\t\"g\",\n\t\t\t{ transform: `translate(${WIDTH / 2},${HEIGHT / 2})` },\n\t\t\tReact.createElement(\"circle\", { r: RADIUS, className: style.wheel }),\n\t\t\tReact.createElement(\n\t\t\t\t\"g\",\n\t\t\t\tnull,\n\t\t\t\tcups.map(({ θ, m }, i) => React.createElement(Cup, { θ: θ, m: m, key: i }))\n\t\t\t)\n\t\t)\n\t);\n});\n\nfunction underSpigot(θ) {\n\treturn θ <= Math.PI * 0.03 || θ >= Math.PI * 1.97;\n}\n\nfunction tick(ω, cups) {\n\tconst torque = γ * d3.sum(cups, d => Math.sin(d.θ) * d.m);\n\tconst cupMass = d3.sum(cups, d => d.m);\n\tconst ω̇ = (torque - ν * ω) / (cupMass + WHEEL_INTERTIA);\n\tω += ω̇;\n\n\tcups = cups.map(({ θ, m }) => {\n\t\tθ = mod(θ + ω, τ);\n\t\tlet under = underSpigot(θ);\n\t\tm = Math.max(m - k * m + (under ? λ : 0), 0);\n\t\treturn { θ, m };\n\t});\n\treturn { cups, ω };\n}\n\nclass App extends React.PureComponent {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tlet state = {\n\t\t\tcups: d3.range(0, NUM_CUPS).map(i => ({\n\t\t\t\tθ: i * τ / NUM_CUPS,\n\t\t\t\tm: 190 / 36 + Math.random() - Math.random()\n\t\t\t})),\n\t\t\tω: 0\n\t\t};\n\t\tfor (var i = 0; i < 700; i++) {\n\t\t\tstate = tick(state.ω, state.cups);\n\t\t}\n\t\tthis.state = state;\n\t\tthis.timer = null;\n\t\tthis.onClick = () => {\n\t\t\tif (this.timer) return this.timer.stop(), this.timer = null;\n\t\t\tthis.timer = d3.timer(() => {\n\t\t\t\tthis.setState(({ cups, ω }) => {\n\t\t\t\t\treturn tick(ω, cups);\n\t\t\t\t});\n\t\t\t});\n\t\t};\n\t}\n\trender() {\n\t\treturn React.createElement(\n\t\t\t\"div\",\n\t\t\t{ className: style.main },\n\t\t\tReact.createElement(\n\t\t\t\t\"div\",\n\t\t\t\t{ className: style.row },\n\t\t\t\tReact.createElement(Vis, { cups: this.state.cups }),\n\t\t\t\tReact.createElement(Plot, { cups: this.state.cups, ω: this.state.ω })\n\t\t\t),\n\t\t\tReact.createElement(\n\t\t\t\t\"button\",\n\t\t\t\t{ onClick: this.onClick },\n\t\t\t\t\"click \"\n\t\t\t)\n\t\t);\n\t}\n}\n\nrender(React.createElement(App, null), document.getElementById(\"root\"));\n\nfunction mod(x, m) {\n\treturn (x % m + m) % m;\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/main.js\n// module id = 82\n// module chunks = 1","// removed by extract-text-webpack-plugin\nmodule.exports = {\"dot\":\"stylePlot__dot___17w\",\"plot\":\"stylePlot__plot___2TO\",\"canvas\":\"stylePlot__canvas___3kH\"};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/stylePlot.css\n// module id = 84\n// module chunks = 1"],"mappings":";;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACzFA;AACA;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACxHA;AACA;;;;A","sourceRoot":""}